# Portfolio Views 기획서 (초안)

> 정환 작가 포트폴리오 - 3가지 전시 방식 구현

## 1. 개요

### 1.1 목표
- 그림 간의 유기적 서사를 시각적으로 표현
- 관객이 언어적 설명 없이 시각적 단서로 이야기를 추측하도록 유도
- 음악 앨범의 라이트모티프처럼 공통 요소로 세계관 형성

### 1.2 3가지 뷰 모드
1. **마인드맵 뷰** - 태그 기반 연결 시각화
2. **색상 뷰** - 색상 스펙트럼 원형 배치
3. **연도 뷰** - 제작연도별 정렬 (기존 방식)

---

## 2. 마인드맵 뷰 (태그 기반)

### 2.1 관리자 기능

#### 태그 시스템
- 모든 그림에 태그 설정 가능
- 태그는 **관리자만** 볼 수 있음 (이용자에게 비공개)
- 태그는 누적되어 다음 작품에서 선택 가능

#### 새 태그 생성 시 동작
1. 새 태그 이름 입력
2. 과거 태그가 있는 모든 작품 리스트 표시
3. 리스트에서 클릭하여 해당 태그 추가 가능
4. 없으면 스킵

### 2.2 프론트엔드 (이용자 화면)

#### 시각화 방식
- **Obsidian 그래프 뷰 스타일** (force-directed graph)
- 노드 = 작품 썸네일 이미지
- 엣지 = 공통 태그가 있는 작품 간 선분

#### 노드 크기 규칙
- 기본 크기 = 1배
- 연결 수에 따라 **선형 증가**
  - 연결 0개 → 1.0배
  - 연결 1개 → 1.1배
  - 연결 2개 → 1.2배
  - 연결 N개 → (1 + N × 0.1)배

#### 노드 형태
- 사각형 유지
- 원본 이미지의 가로×세로 비율 유지하며 축소

#### 연결 규칙
- 공통 태그가 있으면 선으로 연결
- **모든 작품이 공유하는 태그는 제외** (유니버설 태그)

#### 인터랙션
- 줌인/줌아웃
- 상하좌우 패닝
- 노드 클릭 → 작품 상세 보기
- 드래그로 노드 이동 가능 (선택적)

#### 레이아웃
- 중앙 중심이 아닌 **분산형 마인드맵**
- 시간순이 필요하다면 왼쪽→오른쪽 순행

---

## 3. 색상 뷰 (Color Wheel)

### 3.1 관리자 기능

#### 자동 색상 분석
- 이미지 업로드 시 서버에서 **dominant color 자동 추출**
- HSL 형식으로 저장 (Hue 값으로 위치 결정)

#### 분석 알고리즘
- 이미지 리사이즈 (성능)
- 픽셀 히스토그램 분석
- 가장 빈도 높은 색상 추출
- HSL로 변환하여 Hue(0-360) 저장

### 3.2 프론트엔드 (이용자 화면)

#### 시각화 방식
- **색상 스펙트럼 원(도넛)** 형태
- 작품이 Hue 값에 따라 원주 위에 배치

```
        빨강 (0°)
          ↑
   보라       주황
     ↖     ↗
       ●●●
      ●   ●
       ●●●
     ↙     ↘
   파랑       노랑
          ↓
        초록 (180°)
```

#### 배치 규칙
- Hue 0° = 빨강 (12시 방향)
- 시계방향으로 색상 스펙트럼
- 같은 색상대 작품끼리 모임

#### 크기 조정
- 작품 수가 늘어나면 원이 확장됨
- 노드 형태: 사각형, 가로×세로 비율 유지

#### 인터랙션
- 줌인/줌아웃
- 클릭 → 작품 상세 보기
- 색상 범위 필터 (선택적)

---

## 4. 연도 뷰 (Year View)

### 4.1 기존 방식 유지

#### 구조
- 연도 선택 탭/버튼
- 선택 시 해당 연도 작품 표시

#### 정렬
- **제목 가나다 내림차순**

#### 인터랙션
- 작품 클릭 → 확대
- 좌우 스와이프로 다음/이전 작품

---

## 5. 기술 스택

### 5.1 프론트엔드

#### 마인드맵 라이브러리 비교
| 라이브러리 | 장점 | 단점 | 추천도 |
|-----------|------|------|--------|
| `react-force-graph` | 3D 지원, 활발한 유지보수, Obsidian과 유사 | 번들 크기 큼 (~200KB) | ⭐⭐⭐⭐⭐ |
| `@react-sigma/core` | 대규모 그래프 최적화, WebGL | 학습 곡선 높음 | ⭐⭐⭐⭐ |
| `d3-force` 직접 구현 | 완전한 커스터마이징 | 개발 시간 많이 필요 | ⭐⭐⭐ |
| `vis-network` | 쉬운 사용법 | React 통합 불편 | ⭐⭐ |

**권장: `react-force-graph`** - Obsidian 스타일에 가장 적합

#### 색상 휠
- **SVG 기반 커스텀 구현** 권장
- D3.js의 `d3-shape` (arc 생성)
- CSS `conic-gradient`로 배경 처리

#### 줌/패닝
- `react-zoom-pan-pinch` (이미 설치됨) ✅

### 5.2 백엔드

#### 색상 분석 라이브러리 비교
| 라이브러리 | 방식 | 정확도 | 속도 |
|-----------|------|--------|------|
| `node-vibrant` | Modified Quantization | 높음 | 보통 |
| `color-thief-node` | MMCQ 알고리즘 | 중간 | 빠름 |
| `sharp` + 커스텀 | 히스토그램 분석 | 커스텀 | 빠름 |
| `get-image-colors` | k-means | 높음 | 느림 |

**권장: `node-vibrant`** - 정확도와 속도의 균형

#### 색상 추출 플로우
```
이미지 업로드
    ↓
sharp로 리사이즈 (50x50)  ← 성능 최적화
    ↓
node-vibrant로 팔레트 추출
    ↓
Vibrant/Muted 중 대표색 선택
    ↓
HSL 변환 → DB 저장
```

#### API (이미 구현됨) ✅
- `/api/portfolio/mindmap` - 노드/엣지 데이터
- `/api/portfolio/colors` - 색상별 그룹
- `/api/portfolio/years` - 연도별 데이터
- `/api/portfolio/[id]/tags` - 작품 태그 CRUD
- `/api/tags` - 태그 목록

### 5.3 데이터베이스 (이미 구현됨) ✅
- `tags` 테이블 (id, name, created_at)
- `artwork_tags` 테이블 (artwork_id, tag_id)
- `artworks.dominant_color` 컬럼 (HSL 문자열)

---

## 6. UI/UX 흐름

### 6.1 포트폴리오 페이지 진입
```
┌─────────────────────────────────────┐
│  [마인드맵]  [색상]  [연도]          │  ← 탭 네비게이션
├─────────────────────────────────────┤
│                                     │
│         (선택된 뷰 렌더링)            │
│                                     │
└─────────────────────────────────────┘
```

### 6.2 작품 클릭 시
- 모달 또는 상세 페이지로 이동
- 기존 ArtworkModal 재사용

---

## 7. 구현 순서

### Phase 1: 관리자 기능
1. ArtworkForm에 태그 UI 추가
2. 새 태그 생성 시 기존 작품 추가 제안 UI
3. 이미지 업로드 시 dominant color 자동 분석

### Phase 2: 프론트엔드 뷰
1. 포트폴리오 페이지에 탭 추가
2. 연도 뷰 (기존 로직 마이그레이션)
3. 마인드맵 뷰 구현
4. 색상 휠 뷰 구현

### Phase 3: 최적화
1. 대량 작품 시 성능 최적화
2. 모바일 대응
3. 애니메이션/트랜지션

---

## 8. 미결정 사항

- [ ] 마인드맵에서 노드 드래그 허용 여부
- [ ] 색상 분석 실패 시 처리 (미분류 영역?)
- [ ] 모바일에서 마인드맵 인터랙션 방식
- [ ] 연도 뷰에서 카테고리 필터 유지 여부

---

## 9. 성능 고려사항

### 9.1 마인드맵
- 작품 100개 이상 시 WebGL 렌더링 권장
- 초기 로딩: 노드만 먼저 → 엣지는 지연 로딩
- 뷰포트 밖 노드는 렌더링 스킵

### 9.2 색상 휠
- SVG 노드 수 제한 (화면에 보이는 것만)
- 가상화(virtualization) 적용 검토

### 9.3 이미지
- 마인드맵/색상휠에서는 `thumbnail_url` 사용
- lazy loading 적용

---

## 10. 모바일 대응

### 10.1 마인드맵
- 핀치 줌 지원
- 노드 터치 영역 확대 (최소 44px)
- 더블탭 → 줌인

### 10.2 색상 휠
- 스와이프로 회전
- 탭 → 작품 선택

### 10.3 공통
- 뷰 전환 탭은 하단 고정 또는 스와이프 전환

---

## 11. 접근성 (A11y)

- 키보드 네비게이션 지원
- 작품 alt 텍스트
- 고대비 모드에서 연결선 가시성

---

## GPT 교차 검증 요청사항

아래 항목에 대해 검증 필요:

1. **기술 선택**: react-force-graph가 Obsidian 스타일 구현에 최적인가?
2. **색상 분석**: node-vibrant vs color-thief-node 중 어떤 것이 더 적합한가?
3. **성능**: 작품 500개 규모에서 force-directed graph 성능 이슈는?
4. **UX**: 3가지 뷰 전환 시 URL 유지 방식 (query param vs hash)?
5. **누락된 기능**: 이 기획에서 빠진 중요한 고려사항은?

---

## 구현 현황 (2026-02-06)

### ✅ 완료
- [x] 라우팅 구조 (/portfolio/mindmap, /colors, /years)
- [x] 뷰 전환 탭 (ViewTabs)
- [x] 마인드맵 API (이분 그래프 구조)
- [x] 마인드맵 뷰 (Sigma.js + ForceAtlas2 Worker)
- [x] 색상 휠 뷰 (SVG + react-zoom-pan-pinch)
- [x] 연도 뷰 (연도별 그리드)
- [x] 관리자 태그 입력 UI (TagInput)
- [x] 새 태그 생성 시 기존 작품 추가 기능

### ⚠️ 부분 완료
- [ ] 색상 자동 분석 (node-vibrant Turbopack 호환 문제로 비활성화)
  - 현재: 수동 설정 가능
  - 추후: Webpack 빌드 또는 대체 라이브러리로 해결

### 📝 참고
- Sigma.js 직접 통합 (React wrapper 대신) - React 19 호환성 보장
- 태그 노드: 작게(size:3) + 투명하게(alpha:0.3) 표시

---

*작성: 2026-02-06*
*최종 업데이트: 2026-02-06*
*상태: Phase 1-5 완료, Phase 6-7 부분 완료*
